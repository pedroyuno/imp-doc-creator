{% extends "base.html" %}

{% block title %}Edit Feature Rule - {{ feature_name }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4>‚úèÔ∏è Edit Feature Rule: {{ feature_name }}</h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('save_feature_rule') }}">
                    <input type="hidden" name="feature_name" value="{{ feature_name }}">
                    
                    <div class="mb-3">
                        <label for="feature_name_display" class="form-label">Feature Name</label>
                        <input type="text" class="form-control" id="feature_name_display" 
                               value="{{ feature_name }}" disabled>
                        <div class="form-text">Feature name cannot be changed after creation.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="documentation_url" class="form-label">Documentation URL</label>
                        <input type="url" class="form-control" id="documentation_url" 
                               name="documentation_url" required 
                               value="{% if rule.integration_steps and rule.integration_steps|length > 0 %}{{ rule.integration_steps[0].documentation_url }}{% else %}{{ rule.documentation_url }}{% endif %}">
                        <div class="form-text">Enter the complete URL to the documentation for this feature.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="comment" class="form-label">Comment</label>
                        <textarea class="form-control" id="comment" name="comment" rows="4" required>{% if rule.integration_steps and rule.integration_steps|length > 0 %}{{ rule.integration_steps[0].comment }}{% else %}{{ rule.comment }}{% endif %}</textarea>
                        <div class="form-text">Provide a detailed description of the feature and its purpose.</div>
                    </div>
                    
                    <!-- Test Cases Management -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <label class="form-label">Test Cases</label>
                            <a href="{{ url_for('manage_testcases', feature_name=feature_name) }}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-vial"></i> Manage Test Cases
                            </a>
                        </div>
                        {% if rule.testcases %}
                        <div class="card bg-light">
                            <div class="card-body">
                                <p class="mb-2"><strong>{{ rule.testcases|length }} test cases configured:</strong></p>
                                <ul class="mb-0">
                                    {% for testcase in rule.testcases %}
                                    <li>
                                        <strong>{{ testcase.id }}</strong> - {{ testcase.type }}
                                        <small class="text-muted">({{ testcase.environment }})</small>
                                        <small class="text-muted">- {{ testcase.description_key }}</small>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        {% else %}
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <p class="text-muted mb-2">No test cases configured</p>
                                <a href="{{ url_for('add_testcase', feature_name=feature_name) }}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-plus"></i> Add First Test Case
                                </a>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('feature_rules') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Rules
                        </a>
                        <div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Danger Zone -->
        <div class="card mt-4 border-danger">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0">üö® Danger Zone</h6>
            </div>
            <div class="card-body">
                <p class="text-muted">Once you delete a feature rule, there is no going back. Please be certain.</p>
                <form method="POST" action="{{ url_for('delete_feature_rule', feature_name=feature_name) }}" 
                      onsubmit="return confirm('Are you sure you want to delete this feature rule? This action cannot be undone.')">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Delete Feature Rule
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %} 